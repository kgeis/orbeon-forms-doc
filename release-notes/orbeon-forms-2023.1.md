# Orbeon Forms 2023.1

__Sunday, December 31, 2023__  

[NOTE: THIS IS A PREVIEW, AND AS OF 2023-12-17, THIS VERSION OF ORBEON FORMS HASN'T BEEN RELEASED.]

Today we released Orbeon Forms 2023.1! This release is absolutely packed with new features and bug-fixes!

## Major new features

### Token-based permissions

This feature allows you to specify that a user can access form data with readonly or read-write permissions, provided that they are provided a link containing a permission token.

This introduces new permissions in the Form Runner permissions dialog:

<figure>
    <picture>
        <img src="../form-runner/images/dialog-permissions-token.png" width="60%">
    </picture>
    <figcaption>Form Builder Permissions</figcaption>
</figure>

Links generated by Form Runner can optionally include a token that can be shared in a control value, template-generated output, including emails. The token is valid for a certain amount of time.

![Linking to a page with a token](../form-runner/images/control-settings-edit-link-token.png)

An optional "Share" icon is available at the top of a form's Detail page, which allows users to generate and copy a link with a token, provided the form supports token-based permissions.

<figure>
    <picture>
        <img src="../form-runner/images/dialog-share.png" width="60%">
    </picture>
    <figcaption>Share icon and dialog</figcaption>
</figure>

New configuration properties are introduced to configure the token-based permissions feature. For more information, see the [documentation](https://doc.orbeon.com/form-runner/access-control/tokens).

### Comprehensive form and data export

This version introduces a powerful export feature. This is available from the Form Runner Admin page and lets you export a mix of form definitions and form data following several criteria. The result is a zip file containing all the exported form definitions and data, as well as associated attachments.

This is useful in particular for backup purposes and analytics. 

![Export following forms](../form-runner/images/export-following-forms.png)

For more information, see the [documentation](/form-runner/feature/exporting-form-definitions-and-form-data.md)

### Purging of historical form data

This feature is related to the Export feature above. It allows you to delete form data following several criteria. This is useful for GDPR compliance, as well as for reducing the database size. 

![Purge following forms](../form-runner/images/purge-following-forms.png)

For more information, see the [documentation](/form-runner/feature/purging-historical-data.md)

### Data revision history

Form Runner saves *revisions* of the data. Each revision of the data has an associated timestamp. Starting with Orbeon Forms 2023.1, Form Runner provides a UI to access the revision history of a given form data.

Note that this feature is distinct from [form definition versioning](/form-runner/feature/versioning.md).

![Revision History pane](../form-runner/images/fr-revision-history-pane.png)

For more information, see the [documentation](/form-runner/feature/revision-history.md)

### Configurable PDF header and footer

In past versions, you could configure the PDF header and footer using CSS. However, this was cumbersome and error-prone.

You can now configure the PDF header and footer using a declarative configuration. And if you need to add custom CSS, you can still do so, and it's easier than before.

<figure>
    <picture>
        <img src="../form-runner/images/pdf-header-footer-submitted.png" width="75%">
    </picture>
    <figcaption>PDF output with header and footer</figcaption>
</figure>

For more information, see the [documentation](/form-runner/feature/pdf-automatic-header-footer.md).

### Video component

You can now add videos to a form. You can  use the "Video Attachment" control, which allows users to upload a video, or the "Static Video" control, which allows you to specify a static video. This mirrors what is possible with the "Image Attachment" and "Static Image" controls.

![Video attachment](../form-runner/component/images/xbl-video-attachment.png)

The static video This is useful for illustrations, training, and other purposes.

![Static video](../form-runner/component/images/xbl-video.png)

The video player supports scrubbing thanks to changes to the Orbeon Forms persistence backend to retrieve byte ranges.

You can see the Video component in action in the [Controls form](https://demo.orbeon.com/demo/fr/orbeon/controls/new?form-version=2&fr-wizard-page=attachment-controls).

For more information, see the [Video component](/form-runner/component/video.md) and [Video attachment](/form-runner/component/video-attachment.md) documentation.

### Bulk data updates

This new feature allows you to update multiple form data at once directly from a form's Summary page. This is useful for example to update the status of multiple forms at once.

For this to work, the form author must have enabled the "Allow bulk edit" option for at least one form control in the ["Control Settings" dialog](/form-builder/control-settings.md).

![Bulk Edit](../form-runner/images/summary-bookshelf-bulk-edit.png)

For more information, see the [documentation](/form-runner/feature/summary-page.md#bulk-edit).

### Enhancements to email sending

The user interface for email settings has been improved, in particular for attachments settings.

In addition, the following enhancements to the email configuration are introduced:

- You can now send an email conditionally for a specific template ([doc](/form-builder/email-settings.md#usage))
- You can now specify custom email headers, even dynamically ([doc](/form-builder/email-settings.md#custom-headers))

!["Email Settings" dialog](../form-builder/images/email-settings.png)

### Configurable messages and resources in Form Builder

This new Form Builder dialog allows the form author to configure both:

- standard Form Runner messages, such as success and error messages
- and custom resources, such as Form Runner labels, hints, and other messages

![Messages dialog](../form-builder/images/messages.png)

For more information, see the [documentation](/form-builder/messages.md).

### Formula console

The Formulas console allows you to view formulas errors that occur when testing a form.

![Formulas console](../form-builder/images/formulas-console.png)

For more information, see the [documentation](/form-builder/formulas-console.md).

### Copying control content

This new Form Builder action allows you to explicitly copy complex form content from some controls to other controls, including handling of repetitions.

![Example form showing copied content](../form-builder/images/copy-content.png)

For more information, see the [documentation](/form-builder/actions-syntax.md#copying-control-content).

### Table of contents configuration

When not using the Wizard view, as well as in readonly modes such as View and PDF modes, you can now show the table of contents either on the left, on the top, or not at all. The table of content scrolls the page as needed. This is useful for long forms with many sections. You can also control in which modes the table of contents is shown.

![Table of contents on the left](../form-runner/images/toc-left.png)

When enabled in PDF files, the table of contents is always shown on top:

![Table of contents on top in PDF files](../form-runner/images/toc-top-pdf.png)

For more information, see the [documentation](/configuration/properties/form-runner-detail-page.md#show-table-of-contents).

### "Copy to clipboard" button

The following form controls can now optionally show a "Copy to clipboard" button:

- "Text Field"
- "Text Area"
- "Calculated Value"

You control this in the "Control Settings" dialog, using the new "With Clipboard Copy" control appearance.

<figure>
    <picture>
        <img src="../form-builder/images/copy-to-clipboard-appearance.png" width="200px">
    </picture>
    <figcaption>"With Clipboard Copy" control appearance</figcaption>
</figure>

This causes an icon to appear next to the form control. Activating the icon copies the value of the form control to the clipboard.

<figure>
    <picture>
        <img src="../form-runner/images/copy-to-clipboard-text-area.png" width="400px">
    </picture>
    <figcaption>"With Clipboard Copy" control appearance</figcaption>
</figure>

### Open selection

The "Dynamic Dropdown with Search" supports open selection.

<figure>
    <picture>
        <img src="../form-runner/component/images/dynamic-data-dropdown-open.png" width="488">
    </picture>
    <figcaption>Open selection inside the "Control Settings" dialog</figcaption>
</figure>

For more information, see the [documentation](/form-runner/component/static-dynamic-dropdown.md#open-selection).

### Summary page fields roles

You can now restrict showing a field in the Summary page by one or more user roles.

!["Basic Settings" tab](../form-builder/images/control-settings.png)

For more information, see the [documentation](/form-builder/control-settings.md#basic-settings).

### Session expiration warning

When a user's session is about to expire, Form Runner can now show a dialog warning the user.

![Session about to expire](../contributors/images/session-about-to-expire.png)

For more information, see the [documentation](/contributors/state-handling.md#session-expiration-dialog).

## Other new features and enhancements

### Option to store attachments in the filesystem

If you handle large and/or a large number of attachments, you can now configure Form Runner to store attachments in the filesystem instead of the database. This can improve performance and reduce the size of the database.

For more information, see the [documentation](/configuration/properties/persistence.md#attachments).

### Summary page processes

Form Runner supports processes associated with buttons, but so far this was only available on the Detail page. You can now configure processes associated with buttons on the Summary page.

For more information, see the [documentation](/form-runner/advanced/buttons-and-processes/summary-page-buttons-and-processes.md).

### Security features

#### SHA-256

Orbeon Forms now standardizes on SHA-256.

Note that this was also backported to Orbeon Forms 2022.1.3 and newer.

See the [documentation](/configuration/properties/general.md#oxf.crypto.hash-algorithm).

#### Improved encryption passwords

We have now separated `oxf.fr.field-encryption.password` and `oxf.crypto.password`, in addition to `oxf.fr.access-token.password` which is used by the tokens feature described above.

The `oxf.crypto.check-password-strength` property allows checking and reporting about password strength.

See the [documentation](/configuration/properties/general.md#oxf.crypto.check-password-strength).

### Performance improvements 

The following performance enhancements should be noted:

- Form Builder "Edit Source" performance with large form definitions
- Landing page loading
- Free text search performance with PostgreSQL

TODO:

- Persistence proxy/relational to cache form definition #5655

### Usability and accessibility features

#### Grid Tab Order 

You can now set whether the tab navigation order within a grid is:

- By row first, then by column
- By column first, then by row

See the [documentation](/form-builder/grid-settings.md#grid-tab-order).

#### HTML autocomplete attribute

The new "Autocomplete attribute" dropdown allows specifying an [HTML autocomplete value](https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/autocomplete).

See the [documentation](/form-builder/control-settings.md#autocomplete-attribute).

#### Localizations

Thanks to external contributors:

- There are now Catalan language resources for Form Runner.
- The Norwegian Form Runner resources have also been updated.

#### Other usability and accessibility features

- Form Runner
    - The Wizard supports separate short section labels ([doc](/form-builder/section-settings.md#label-help-message-and-short-labels))
    - Empty file attachments are now rejected by default ([doc](/xforms/controls/upload.md#empty-files))
    - Invalid attachment messages are improved
    - Automatic hints are supported for the maximum file size and file types ([doc](/form-builder/control-settings.md#automatic-hints))
    - Automatically focus on the first invalid field after closing Errors/Validation dialogs
    - The Excel import now shows errors immediately when reviewing uploaded data
    - The "Date" field supports the native date picker on the desktop ([doc](/form-runner/component/date.md#native-date-picker))
    - New experimental properties allow configuring automatic PDF accessibility and PDF/A settings ([doc](/form-runner/feature/pdf-automatic.md#accessibility-and-pdf-a-support))
- Form Builder usability
    - "Test PDF" produces meaningful filenames
    - Cmd/Ctrl-Enter commit the value in "Edit Source"
    - You are warned when referring to a non-existent variable in a formula
    - You can easily reset the value of a "Yes/No Answer" ([doc](/form-runner/component/yesno-input.md))

TODO:

- Add suggestion of variable names in all formulas #5798

### New and improved APIs

- Client-side APIs
    - The Wizard supports navigating to a specific section via URL ([doc](/form-runner/feature/wizard-view.md#page-name-url-parameter))
    - New JavaScript API to register a listener for process callbacks ([doc](/form-runner/advanced/buttons-and-processes/actions-form-runner.md#registering-a-callback-function), [doc](/form-runner/advanced/buttons-and-processes/actions-form-runner.md#callback))
    - New JavaScript API to get a reference to an object representing a Form Runner form ([doc](/form-runner/api/other/form-runner-javascript-api.md#getting-a-reference-to-a-form))
    - New JavaScript API to activate Process buttons ([doc](/form-runner/api/other/form-runner-javascript-api.md#activating-a-process-button))
    - New JavaScript API to activate a form control ([doc](/form-runner/api/other/form-runner-javascript-api.md#activating-a-form-control))
    - Improved JavaScript to set the value of a form control ([doc](/form-runner/api/other/form-runner-javascript-api.md#setting-a-controls-value))
- Server-side APIs
    - Page path and parameters information are passed to the file scanner ([doc](/form-runner/api/other/file-scan-api.md#api))
    - Export services are now also exposed as pages URLs ([doc](/form-runner/link-embed/linking.md))
    - A new API allows you to produce PDF and TIFF exports using service URLs ([doc](/form-runner/api/other/pdf-api.md))
    - New parameters allow controlling PDF production ([doc](/form-runner/api/other/pdf-api.md#other-parameters))

### Other Form Builder features

You can now directly download a form definition XHTML from Form Builder ([doc](/form-builder/buttons-bar.md))

### Other Form Runner features

- You can now opt to keep the "Formatted Text Area" colors in PDF output ([doc](/form-runner/feature/pdf-automatic.md#pdf-color-mode))
- The Summary page field search can show dropdown values for controls without static items ([doc](/form-runner/feature/summary-page.md#dynamic-dropdowns))
- The `success-message()` and `error-message()` now support HTML ([doc](/form-runner/advanced/buttons-and-processes/actions-form-runner.md#success-message-and-error-message))
- The Import page validate static lists of choices when using named ranges Excel files
- The Excel and XML export buttons can also be present on the Summary page ([doc](/form-runner/advanced/buttons-and-processes/summary-page-buttons-and-processes.md#configuring-summary-page-buttons))
- XPath functions for checking permissions now work ([doc](/xforms/xpath/extension-form-runner.md#authentication-functions))
- You can now configure the "Dynamic Dropdown with Search" with a minimum input length ([doc](/form-runner/component/static-dynamic-dropdown.md#minimum-input-length))
- You can configure the Image Annotation start stroke color ([doc](/form-runner/component/image-annotation.md))
- You can now optionally show required stars in produced PDF files ([doc](/form-runner/advanced/buttons-and-processes/actions-form-runner.md#open-rendered-format))

    <figure>
        <picture>
            <img src="../form-builder/images/test-pdf-hints-alerts-required.png" width="60%">
        </picture>
        <figcaption>Options to show hints, alerts, and required</figcaption>
    </figure>

### Enhancements to actions

New actions are introduced:

- Add `fr:control-setfocus` action ([doc](/form-builder/actions-syntax.md#setting-the-focus-on-a-form-control))
- Add `fr:control-setvisited` action ([doc](/form-builder/actions-syntax.md#marking-a-form-control-visited-or-unvisited))
- Add `fr:dataset-clear` action ([doc](/form-builder/actions-syntax.md#clearing-a-dataset))
- Add `fr:control-setsize` to the Action Syntax ([doc](/form-builder/actions-syntax.md#setting-the-size-of-an-attachment-control))

In addition:

- Actions can now optionally run their services asynchronously ([doc](/form-builder/actions-syntax.md#asynchronous-actions))
- The action syntax is supported in Section Templates

### Embedding and offline support

#### Offline support for attachments

Form Runner now includes support for attachments in the offline mode.

Note that this feature is currently only usable when embedding Orbeon Forms within a native application. It is not available when using the Form Runner standalone web application. However, you can attach files in the "Test Offline" mode of Form Builder.

For more information, see the [API documentation](/form-runner/link-embed/offline-embedding-api.md), and the [Test offline](/form-builder/offline-test.md) feature.

#### Offline support for asynchronous service calls

The `SubmissionProvider` service call API now supports asynchronous responses, as well as streamed and chunked request and response bodies. 

For more information, see the [API documentation](/form-runner/link-embed/offline-embedding-api.md), and the [Test offline](/form-builder/offline-test.md) feature.

This in particular allows the [Dropdown with Search control](/form-runner/component/static-dynamic-dropdown.md) to work offline, as well as the ability to stream attachments content, for example between a native application and Form Runner.

#### Cross-site JavaScript embedding

You can now embed Form Runner forms in a different domain than the one where Form Runner is deployed. This is done through the Form [Runner JavaScript embedding API](/form-runner/link-embed/javascript-api.md#option-2-cross-origin).

#### Promise returns an object

`embedForm()` returns a JavaScript `Promise` object representing the form. The object supports functions documented in [The `FormRunnerForm` object](/form-runner/api/other/form-runner-javascript-api.md#the-formrunnerform-object).

### XForms features

- `event()` is supported for `replace="all"` submissions ([doc](/xforms/submission-extensions.md#event-properties-with-replace-all))
- You can tunnel context information to submission and error events ([doc](/xforms/events-extensions-other.md#tunnelling-of-events-properties))
- Delayed events support passing atomic properties ([doc](/xforms/events-standard.md#delayed-events))

### Platform features

- We upgraded to Font Awesome 6
- Orbeon Forms now supports Tomcat 10+, WildFly 27+ (TODO)
- In addition to Ehcahe 2.x, we added support for the JCache API (JSR-107) ([doc](/installation/caches.md#enabling-jcache-providers))
- Expired sessions now send a status code 440 to the client

## Compatibility notes

### Visiting of visible fields

In Orbeon Forms, a form control can be *visited* or not. Visited controls have typically been visited by the user, which means that the user navigated through the form control, possibly without changing its value. One way to visit form controls is to navigate using the "Tab" key, or to click on the form control and then click outside of it. Another way is to use the default "Save" or "Send" buttons, which by default visit all the form controls before proceeding. The notion is used to determine whether to show validation errors associated with that form control.

With Orbeon Forms 2023.1, form controls are also marked as visited when they are calculated, visible, and their value changes. This is useful to immediately show validation errors associated with such form controls, which are typically implemented with the Calculated Value form control.

If you don't wish this behavior, you can turn it off globally with the following property:

```xml
<property
    as="xs:boolean"
    name="oxf.xforms.xbl.fr.error-summary.visit-value-changed"
    value="false"/>
```

### Password strength checker

A [password strength checker](/configuration/properties/general.md#oxf.crypto.check-password-strength) will cause an error if one of the passwords configured in your `properties-local.xml` is too weak. Ideally, use randomly-generated strong passwords.

If you are using field-level encryption, and if you already have data in your database that contains encrypted fields, and if you are getting an error upon starting Orbeon Forms telling you that the encryption password is too weak, you can disable the password strength checker:

```xml
<property
    as="xs:boolean"
    name="oxf.crypto.check-password-strength"
    value="false"/>
```

We do not recommend disabling this in general. Instead, always use strong randomly-generated passwords. 

### Encryption passwords

If set, the `oxf.fr.field-encryption.password` property controls a separate encryption password for field-level encryption. If not set, the `oxf.crypto.password` property is used instead for backward compatibility.

```xml
<property
	as="xs:string"
	name="oxf.fr.field-encryption.password"
	value="CHANGE THIS PASSWORD"/>
```

- If you are upgrading from an earlier version of Orbeon Forms, and you already have data in your database that contains encrypted fields:
    - Set `oxf.fr.field-encryption.password` anyway, to the same value as `oxf.crypto.password`.
- If you are not in the above case, set `oxf.fr.field-encryption.password` to a value different from `oxf.crypto.password`. 

### CRUD API

When calling the [CRUD API](/form-runner/api/persistence/crud), you can `PUT` data as well as form definitions and their attachments.

When `PUT`ting data, Form Runner does a number of checks, including a check for permissions. In the past, in some cases, `PUT`ting data for a non-existent form definition could succeed. This is no longer the case, and you should make sure that the form definition exists before `PUT`ting data.

### eXist DB removal

This version of Orbeon Forms removes support for the eXist DB database. Use of this database has been deprecated for a long time, and we have not been able to maintain it for a while. If you are using eXist DB, please migrate to a [relational database](/form-runner/persistence/relational-db.md). ([#5770](https://github.com/orbeon/orbeon-forms/issues/5770))

### Uploading empty files

Starting with 2023.1, uploaded files that are empty are rejected out-of-the-box. Should you need to accept such files in your forms, you can [set a property to allow them](/xforms/controls/upload.md#empty-files).
